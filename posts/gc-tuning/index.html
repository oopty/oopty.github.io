<!DOCTYPE html><html lang="custom" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="prefer-datetime-locale" content="ko"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="가비지 컬렉터 튜닝" /><meta property="og:locale" content="custom" /><meta name="description" content="지난 이야기 Garbage Collector에 대해 정리해놓은 글에서 Reference &amp; Reachable Object와 Heap 영역의 구조, GC 알고리즘에 대해 설명했습니다. 이번 시간에는 Parallel Collector에 대해 조금 더 설명한 후에 GC 튜닝 방법에 대해 설명하려고 합니다. Parallel Collector (Throughput Collector) Java8에서 default collector입니다. Serial Collector와 비슷하게 동작하지만 차이점은 여러 개의 쓰레드를 가지고 Garbage Collect를 수행해 더 빠르게 동작할 수 있습니다. 멀티 코어나 프로세서환경에서는 이점이 있지만 싱글 코어이거나 힙 사이즈가 100MB 이하인 경우 Serial Collector와 별다른 차이가 없을 수 있습니다. 각 실행환경마다 다르니 많은 테스트를 통해 환경에 맞는 Collector와 파라미터를 찾아야 합니다. 1 -XX:+UseParallelGC 위 옵션으로 사용할 수 있습니다." /><meta property="og:description" content="지난 이야기 Garbage Collector에 대해 정리해놓은 글에서 Reference &amp; Reachable Object와 Heap 영역의 구조, GC 알고리즘에 대해 설명했습니다. 이번 시간에는 Parallel Collector에 대해 조금 더 설명한 후에 GC 튜닝 방법에 대해 설명하려고 합니다. Parallel Collector (Throughput Collector) Java8에서 default collector입니다. Serial Collector와 비슷하게 동작하지만 차이점은 여러 개의 쓰레드를 가지고 Garbage Collect를 수행해 더 빠르게 동작할 수 있습니다. 멀티 코어나 프로세서환경에서는 이점이 있지만 싱글 코어이거나 힙 사이즈가 100MB 이하인 경우 Serial Collector와 별다른 차이가 없을 수 있습니다. 각 실행환경마다 다르니 많은 테스트를 통해 환경에 맞는 Collector와 파라미터를 찾아야 합니다. 1 -XX:+UseParallelGC 위 옵션으로 사용할 수 있습니다." /><link rel="canonical" href="https://oopty.github.io/posts/gc-tuning/" /><meta property="og:url" content="https://oopty.github.io/posts/gc-tuning/" /><meta property="og:site_name" content="oopty" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-12T02:14:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="가비지 컬렉터 튜닝" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-01-15T21:34:38+09:00","datePublished":"2022-06-12T02:14:00+09:00","description":"지난 이야기 Garbage Collector에 대해 정리해놓은 글에서 Reference &amp; Reachable Object와 Heap 영역의 구조, GC 알고리즘에 대해 설명했습니다. 이번 시간에는 Parallel Collector에 대해 조금 더 설명한 후에 GC 튜닝 방법에 대해 설명하려고 합니다. Parallel Collector (Throughput Collector) Java8에서 default collector입니다. Serial Collector와 비슷하게 동작하지만 차이점은 여러 개의 쓰레드를 가지고 Garbage Collect를 수행해 더 빠르게 동작할 수 있습니다. 멀티 코어나 프로세서환경에서는 이점이 있지만 싱글 코어이거나 힙 사이즈가 100MB 이하인 경우 Serial Collector와 별다른 차이가 없을 수 있습니다. 각 실행환경마다 다르니 많은 테스트를 통해 환경에 맞는 Collector와 파라미터를 찾아야 합니다. 1 -XX:+UseParallelGC 위 옵션으로 사용할 수 있습니다.","headline":"가비지 컬렉터 튜닝","mainEntityOfPage":{"@type":"WebPage","@id":"https://oopty.github.io/posts/gc-tuning/"},"url":"https://oopty.github.io/posts/gc-tuning/"}</script><title>가비지 컬렉터 튜닝 | oopty</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="oopty"><meta name="application-name" content="oopty"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /commons/avatar.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">oopty</a></div><div class="site-subtitle font-italic">Stand on the shoulders of giants</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/oopty" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['minjun13795','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>가비지 컬렉터 튜닝</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img data-src="/assets/images/java-gc.jpeg" class="preview-img bg" alt="java gc" data-proofer-ignore><h1 data-toc-skip>가비지 컬렉터 튜닝</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/oopty">oopty</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1654967640" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-12 </em> </span> <span> Updated <em class="timeago" data-ts="1673786078" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-01-15 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2649 words"> <em>14 min</em> read</span></div></div></div><div class="post-content"><h1 id="지난-이야기">지난 이야기</h1><p>Garbage Collector에 대해 <a href="https://oopty.github.io/posts/jvm/">정리해놓은 글</a>에서 Reference &amp; Reachable Object와 Heap 영역의 구조, GC 알고리즘에 대해 설명했습니다. 이번 시간에는 Parallel Collector에 대해 조금 더 설명한 후에 GC 튜닝 방법에 대해 설명하려고 합니다.</p><h2 id="parallel-collector-throughput-collector"><span class="mr-2">Parallel Collector (Throughput Collector)</span><a href="#parallel-collector-throughput-collector" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Java8에서 default collector입니다. Serial Collector와 비슷하게 동작하지만 차이점은 여러 개의 쓰레드를 가지고 Garbage Collect를 수행해 더 빠르게 동작할 수 있습니다. 멀티 코어나 프로세서환경에서는 이점이 있지만 싱글 코어이거나 힙 사이즈가 100MB 이하인 경우 Serial Collector와 별다른 차이가 없을 수 있습니다. 각 실행환경마다 다르니 많은 테스트를 통해 환경에 맞는 Collector와 파라미터를 찾아야 합니다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> -XX:+UseParallelGC
</pre></table></code></div></div><p>위 옵션으로 사용할 수 있습니다.</p><p>Parallel Collector에서 사용할 수 있는 여러 옵션이 있습니다. 첫번째로 Garbage Collect에 사용할 쓰래드 수를 결정할 수 있습니다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>-XX:ParallelGCThreads=&lt;N&gt;
</pre></table></code></div></div><p>항상 N만큼 쓰레드 수를 Garbage Collect에 사용하는 것은 아니고 일정 비율을 곱해 나온 수만큼 사용합니다. 예를 들어 N이 꽤 클 경우(8이상)에는 5/8을 곱합니다.</p><p>또한 옵션으로 행위 기반 튜닝을 할 수 있습니다. 원하는 목표치를 JVM에게 힌트로 주고 JVM은 내부적으로 통계치를 이용하거나 다른 변수들을 조절해 목표치를 달성합니다. 아래 3가지 목표를 설정할 수 있습니다.</p><ul><li>최대 일시 정지 시간 최소화 목표 <code class="language-plaintext highlighter-rouge">-XX:MaxGCPauseMillis=&lt;nnn&gt;</code><ul><li>너무 낮게 설정하면 전체적인 처리율이 떨어짐<li>GC가 일시 정지 시간을 예측해서 그에 맞게 Heap 사이즈나 여러 변수들을 조정함</ul><li>처리율 향상 목표 <code class="language-plaintext highlighter-rouge">-XX:GCTimeRatio=&lt;nnn&gt;</code><ul><li>GC시간과 애플리케이션 시간 비율이 $1\over1+nnn$으로 설정</ul><li><p>Footprint</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>  -Xms=&lt;nnn&gt;
  -Xms=&lt;mmm&gt;
</pre></table></code></div></div><ul><li>최대 일시 정지 시간, 처리율 향상 목표를 달성한다면 GC는 두 목표중 하나가 실패할 때 까지 Heap사이즈를 줄임<li>일시 정지 시간 최소화 목표에 의해 Heap 사이즈는 계속 커진 다음에 최대 처리율을 달성하기 위해 계속 Heap사이즈는 줄어듬<li>이렇게 경쟁적인 목표를 계속 달성하려고 하면서 최적의 값을 찾음</ul></ul><h1 id="garbage-collector-튜닝이-필요한-이유">Garbage Collector 튜닝이 필요한 이유</h1><p>모든 프로젝트에 진행할 필요는 없습니다. 하지만 힙 사이즈를 설정했거나 Timeout과 같은 에러메시지가 로그에서 나온다면 튜닝이 필요하다고 할 수 있습니다. 프로그램이 생각보다 많은 메모리를 필요로 하다면 팀의 코딩 스타일을 살펴볼 필요가 있습니다. StringBuffer나 StringBuilder를 활용하지 않고 String으로만 사용한다던지, 매우 큰 용량의 파일을 열어놓고 닫지는 않는다든지 하는 프로그램 로직적인 부분을 먼저 살펴보고 튜닝을 진행해야 합니다. 먼저 말씀드리지만 GC 튜닝은 실험적인 방법으로 최적화를 합니다. 다른 프로젝트에서 좋은 성능을 보였던 옵션이 이번 프로젝트에서는 오히려 낮은 성능을 초래하고 심지어 OutOfMemory 예외를 만날 수도 있습니다.</p><p>먼저 trade-off 관계인 아래 지표를 봅시다</p><ul><li>최대 정지 시간<li>총 처리율</ul><p>두 지표 모두 힙 사이즈에 큰 영향을 받고 대부분의 상황에서 비례 관계를 갖습니다. 따라서 적당한 값을 어플리케이션의 특성에 맞게 조절해야합니다. 최대 정지 시간을 너무 높게 잡으면 사용자들이 보낸 요청을 STW가 일어나는 동안은 처리할 수 없고 이는 장애로 인식될 수 있습니다. 그렇다고 최대 정지 시간을 낮추려고 힙사이즈를 줄이면 GC가 매우 빈번히 일어날 것이고 Context Switch 비용 때문에 총 처리율이 낮아질 수 있습니다. 이는 최대 동시 접속자 수를 낮추게 될 것이고 원하는 최대 동시 접속자 수만큼 수용이 가능한지 체크해봐야 합니다.</p><h1 id="garbage-collector-모니터링-방법">Garbage Collector 모니터링 방법</h1><h2 id="jstat"><span class="mr-2">jstat</span><a href="#jstat" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>jstat은 HotSpot JVM에 있는 모니터링 도구이다. jdk를 설치하면 $JAVA_HOME/bin 디렉토리에 포함되어 있어 <code class="language-plaintext highlighter-rouge">jstat</code>으로 바로 실행할 수 있습니다. 각 힙 영역의 최대, 최소 사이즈와 현재 사이즈를 볼 수 있고, 지난 GC의 원인 및 GC 수행 시간을 확인할 수 있습니다. -gcutil(또는 -gccause), -gc, -gccapacity을 가장 많이 사용합니다. 각 컬럼의 뜻은 아래와 같습니다.</p><p>칼럼 설명 jstat 옵션</p><div class="table-wrapper"><table><thead><tr><th>칼럼<th>설명<th>jstat 옵션<tbody><tr><td>S0C<td>Survivor 0 영역의 현재 크기를 KB 단위로 표시<td>-gc -gccapacity -gcnew -gcnewcapacity<tr><td>S1C<td>Survivor 1 영역의 현재 크기를 KB 단위로 표시<td>-gc -gccapacity -gcnew -gcnewcapacity<tr><td>S0U<td>Survivor 0 영역의 현재 사용량을 KB 단위로 표시<td>-gc -gcnew<tr><td>S1U<td>Survivor 1 영역의 현재 사용량을 KB 단위로 표시<td>-gc -gcnew<tr><td>EC<td>Eden 영역의 현재 크기를 KB 단위로 표시<td>-gc -gccapacity -gcnew -gcnewcapacity<tr><td>EU<td>Eden 영역의 현재 사용량을KB 단위로 표시<td>-gc -gcnew<tr><td>OC<td>Old 영역의 현재 크기를 KB 단위로 표시<td>-gc -gccapacity -gcold -gcoldcapacity<tr><td>OU<td>Old 영역의 현재 사용량을KB 단위로 표시<td>-gc -gcold<tr><td>PC<td>Permanent영역의 현재 크기를 KB 단위로 표시<td>-gc -gccapacity -gcold -gcoldcapacity -gcpermcapacity<tr><td>PU<td>Permanent영역의 현재 사용량을KB 단위로 표시<td>-gc -gcold<tr><td>YGC<td>Young Generation의 GC 이벤트 발생 횟수<td>-gc -gccapacity -gcnew -gcnewcapacity -gcold -gcoldcapacity -gcpermcapacity -gcutil -gccause<tr><td>YGCT<td>Yong Generation의 GC 수행 누적 시간<td>-gc -gcnew -gcutil -gccause<tr><td>FGC<td>Full GC 이벤트가 발생한 횟수<td>-gc -gccapacity -gcnew -gcnewcapacity -gcold -gcoldcapacity -gcpermcapacity -gcutil -gccause<tr><td>FGCT<td>Full GC 수행 누적 시간<td>-gc -gcold -gcoldcapacity -gcpermcapacity -gcutil -gccause<tr><td>GCT<td>전체 GC 수행 누적 시간<td>-gc -gcold -gcoldcapacity -gcpermcapacity -gcutil -gccause<tr><td>NGCMN<td>New Generation의 최소 크기를 KB단위로 표시<td>-gccapacity -gcnewcapacity<tr><td>NGCMX<td>New Generation의 최대 크기를 KB단위로 표시<td>-gccapacity -gcnewcapacity<tr><td>NGC<td>New Generation의 현재 크기를 KB단위로 표시<td>-gccapacity -gcnewcapacity<tr><td>OGCMN<td>Old Generation의 최소 크기를 KB단위로 표시<td>-gccapacity -gcoldcapacity<tr><td>OGCMX<td>Old Generation의 최대 크기를 KB단위로 표시<td>-gccapacity -gcoldcapacity<tr><td>OGC<td>Old Generation의 현재 크기를 KB단위로 표시<td>-gccapacity -gcoldcapacity<tr><td>PGCMN<td>Permanent Generation의 최소 크기를 KB단위로 표시<td>-gccapacity -gcpermcapacity<tr><td>PGCMX<td>Permanent Generation의 최대 크기를 KB단위로 표시<td>-gccapacity -gcpermcapacity<tr><td>PGC<td>현재 Permanent Generation의 크기를 KB단위로 표시<td>-gccapacity -gcpermcapacity<tr><td>PC<td>Permanent 영역의 현재 크기를 KB단위로 표시<td>-gccapacity -gcpermcapacity<tr><td>PU<td>Permanent 영역의 현재 사용량을 KB단위로 표시<td>-gc -gcold<tr><td>LGCC<td>지난 GC의 발생 이유<td>-gccause<tr><td>GCC<td>현재 GC의 발생 이유<td>-gccause<tr><td>TT<td>Tenuring threshold. Young 영역 내에서 <br />이 횟수만큼 복사되었을 경우(S0 -&gt;S1, S1-&gt;S0) Old 영역으로 이동<td>-gcnew<tr><td>MTT<td>최대 Tenuring threshold. Yong 영역 내에서 <br />이 횟수만큼 복사되었을 경우 Old 영역으로 이동<td>-gcnew<tr><td>DSS<td>적절한 Survivor 영역의 크기를 KB단위로 표시<td>-gcnew</table></div><p>위 정보를 jstatd를 통해 원격에서도 볼 수 있고 visual GC를 통해 GUI환경에서 조금 더 직관적이고 쉽게 볼 수 있습니다.</p><h2 id="jvm-visual"><span class="mr-2">JVM Visual</span><a href="#jvm-visual" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>jstat은 JVM을 실행할 때 별다른 옵션을 주지않아도 되는 장점이 있지만 GC 수행에 대해서는 간단한 정보만 제공하는 단점이 있습니다. 각 GC의 개별적인 수행 정보를 알고 싶으면 JVM을 실행할 때 <code class="language-plaintext highlighter-rouge">-verbosegc</code> 옵션을 주어 얻을 수 있습니다. 이 정보에서 Full GC와 Minor GC가 몇 번 일어났고 수행 전 후의 메모리 사이즈의 변화도 알 수 있습니다. 시각화 툴로는 HPJmeter를 사용할 수 있습니다.</p><h1 id="튜닝">튜닝</h1><h2 id="튜닝-절차"><span class="mr-2">튜닝 절차</span><a href="#튜닝-절차" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="1-gc-모니터링-결과-분석-후-gc-튜닝-여부-결정"><span class="mr-2">1. GC 모니터링 결과 분석 후 GC 튜닝 여부 결정</span><a href="#1-gc-모니터링-결과-분석-후-gc-튜닝-여부-결정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>jstat이나 jvm의 -verbosegc 설정으로 GC 모니터링을 합니다. GC 모니터링 결과 Full GC가 1초가 넘어가거나 너무 자주 발생한다면 GC 튜닝을 진행해야 합니다. 고려해야하는 것은 <code class="language-plaintext highlighter-rouge">young영역과 old영역의 비율</code>, <code class="language-plaintext highlighter-rouge">Heap 사이즈</code>, <code class="language-plaintext highlighter-rouge">Survivor와 Eden의 비율</code>, <code class="language-plaintext highlighter-rouge">Survivor의 Max aging</code> 등이 있습니다.</p><h3 id="2-gc-방식메모리-크기-지정-등-파라미터-변경"><span class="mr-2">2. GC 방식/메모리 크기 지정 등 파라미터 변경</span><a href="#2-gc-방식메모리-크기-지정-등-파라미터-변경" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>여러 GC 중 적합한 방식의 GC를 선택해서 적용해야 하고 메모리 크기와 비율도 어플리케이션의 특성에 맞춰 변경해야 합니다. 하지만 예상과 다른 전혀 다른 GC와 파라미터가 성능이 좋을 수도 있습니다. GC 튜닝은 실험과학이라는 사실을 기억해야 합니다. 여러 서버에 다양한 파라미터를 적용하고 충분한 시간을 기다려야 합니다.</p><h3 id="3-결과가-만족스러울-경우-전체-서버에-반영-및-종료"><span class="mr-2">3. 결과가 만족스러울 경우 전체 서버에 반영 및 종료</span><a href="#3-결과가-만족스러울-경우-전체-서버에-반영-및-종료" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>OutOfMemory가 발생하지 않고 성공적으로 원하는 GC 시간과 빈도를 달성했다면 전체 서버에 반영하고 예후를 지켜봅니다.</p><h2 id="튜닝시-주의할-점"><span class="mr-2">튜닝시 주의할 점</span><a href="#튜닝시-주의할-점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>튜닝을 하기 전에 메모리 누수나 메모리를 남용하고 있는 코드가 없는지 살펴봐야 합니다. 힙 메모리를 덤프한 후 튜닝 전략을 세우는 것도 좋지만 특정 상황에 치우친 튜닝을 하기 쉽고 서비스의 사용량이 많고 사용자의 패턴이 아주 다양한 경우에는 OutOfMemory 에러나 오히려 GC 소요시간이 길어지거나 빈도가 증가할 수 있습니다. 따라서 실험적인 방법을 통해 경험을 축적하면서 자연 선택적으로(?) 튜닝을 하는 방법을 추천한다고 합니다.</p><h1 id="출처">출처</h1><ul><li><a href="https://d2.naver.com/helloworld/6043">NAVER D2: Garbage Collection 모니터링 방법</a><li><a href="https://d2.naver.com/helloworld/37111">NAVER D2: Garbage Collection 튜닝</a><li><a href="https://johngrib.github.io/wiki/java-gc-tuning/">기계인간 John Grib: Java GC 튜닝</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/jvm/" class="post-tag no-text-decoration" >jvm</a> <a href="/tags/gc/" class="post-tag no-text-decoration" >gc</a> <a href="/tags/gc-tuning/" class="post-tag no-text-decoration" >gc tuning</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%EA%B0%80%EB%B9%84%EC%A7%80+%EC%BB%AC%EB%A0%89%ED%84%B0+%ED%8A%9C%EB%8B%9D+-+oopty&url=https%3A%2F%2Foopty.github.io%2Fposts%2Fgc-tuning%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%EA%B0%80%EB%B9%84%EC%A7%80+%EC%BB%AC%EB%A0%89%ED%84%B0+%ED%8A%9C%EB%8B%9D+-+oopty&u=https%3A%2F%2Foopty.github.io%2Fposts%2Fgc-tuning%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Foopty.github.io%2Fposts%2Fgc-tuning%2F&text=%EA%B0%80%EB%B9%84%EC%A7%80+%EC%BB%AC%EB%A0%89%ED%84%B0+%ED%8A%9C%EB%8B%9D+-+oopty" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/effective-java-item-1/">Effective Java 정리 Item1</a><li><a href="/posts/gc-tuning/">가비지 컬렉터 튜닝</a><li><a href="/posts/java-study1/">함수형 프로그래밍의 의미와 장점</a><li><a href="/posts/javascript-execution-concepts/">자바스크립트 동작 원리에대한 개념 정리</a><li><a href="/posts/linux-concept-is-confused/">리눅스 헷갈리는 개념 포스팅</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/gc/">gc</a> <a class="post-tag" href="/tags/garbege-collector/">garbege collector</a> <a class="post-tag" href="/tags/jvm/">jvm</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/anotation/">anotation</a> <a class="post-tag" href="/tags/chmod/">chmod</a> <a class="post-tag" href="/tags/cms-gc/">cms gc</a> <a class="post-tag" href="/tags/collaberations/">collaberations</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/jvm/"><div class="card-body"> <em class="timeago small" data-ts="1639915740" > 2021-12-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JVM의 구조와 GC</h3><div class="text-muted small"><p> JVM 구조 JVM은 자바 바이트 코드를 실행할 수 있는 주체이고 일반적으로 인터프리터나 미리 기계어로 만들어 놓는 방식인 JIT(Just in Time) 방식으로 다른 컴퓨터 위에서 바이트 코드를 실행할 수 있도록 만들어 놓은 프로그램 또는 하드웨어이다. 운영체제에 상관없이 JVM위에서 같은 동작이 구동되게 보장하고 GC와 같은 메모리 관리와 클래스...</p></div></div></a></div><div class="card"> <a href="/posts/mvc-testing/"><div class="card-body"> <em class="timeago small" data-ts="1656760440" > 2022-07-02 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring Boot와 @WebMVCTest로 MVC Controller를 테스트 하는 방법</h3><div class="text-muted small"><p> 이 글은 Testing MVC Web Controllers with Spring Boot and @WebMvcTest을 해석하고 정리한 글입니다. 이번 글에서는 Controller에 대해 살펴볼 것이다. 먼저 책임 전체를 수용하는 테스트를 작성하기 위해 web Controller가 무엇을 하는지 탐색할 것이다. 그러고 각각 책임을 수용하는 테스트를 ...</p></div></div></a></div><div class="card"> <a href="/posts/javascript-execution-concepts/"><div class="card-body"> <em class="timeago small" data-ts="1639320300" > 2021-12-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자바스크립트 동작 원리에대한 개념 정리</h3><div class="text-muted small"><p> 시작하며 이번에는 자바 런타임에서 바이트코드를 실행할 수 있는 JVM(Java Virtual Machine)과 Javascript 엔진인 V8에 대해 비교하며 살펴보려고 합니다. 개발하다 보면 많이 듣는 용어고 의미정도는 어렴풋이 알고 있긴 하지만 설명을 하라고 하면 못할 거 같습니다.. 😓 그래서 이번엔 V8과 JVM에 대해 정리하고 관련된 용어(N...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/linux-concept-is-confused/" class="btn btn-outline-primary" prompt="Older"><p>리눅스 헷갈리는 개념 포스팅</p></a> <a href="/posts/mvc-testing/" class="btn btn-outline-primary" prompt="Newer"><p>Spring Boot와 @WebMVCTest로 MVC Controller를 테스트 하는 방법</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/oopty">oopty</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/gc/">gc</a> <a class="post-tag" href="/tags/garbege-collector/">garbege collector</a> <a class="post-tag" href="/tags/jvm/">jvm</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/anotation/">anotation</a> <a class="post-tag" href="/tags/chmod/">chmod</a> <a class="post-tag" href="/tags/cms-gc/">cms gc</a> <a class="post-tag" href="/tags/collaberations/">collaberations</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-D6L4PXVM2Z"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-D6L4PXVM2Z'); }); </script>
