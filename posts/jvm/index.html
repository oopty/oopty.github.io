<!DOCTYPE html><html lang="custom" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="prefer-datetime-locale" content="ko"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="JVM의 구조와 GC" /><meta property="og:locale" content="custom" /><meta name="description" content="JVM 구조 JVM은 자바 바이트 코드를 실행할 수 있는 주체이고 일반적으로 인터프리터나 미리 기계어로 만들어 놓는 방식인 JIT(Just in Time) 방식으로 다른 컴퓨터 위에서 바이트 코드를 실행할 수 있도록 만들어 놓은 프로그램 또는 하드웨어이다. 운영체제에 상관없이 JVM위에서 같은 동작이 구동되게 보장하고 GC와 같은 메모리 관리와 클래스 로더를 통해 명령을 실행한다." /><meta property="og:description" content="JVM 구조 JVM은 자바 바이트 코드를 실행할 수 있는 주체이고 일반적으로 인터프리터나 미리 기계어로 만들어 놓는 방식인 JIT(Just in Time) 방식으로 다른 컴퓨터 위에서 바이트 코드를 실행할 수 있도록 만들어 놓은 프로그램 또는 하드웨어이다. 운영체제에 상관없이 JVM위에서 같은 동작이 구동되게 보장하고 GC와 같은 메모리 관리와 클래스 로더를 통해 명령을 실행한다." /><link rel="canonical" href="https://oopty.github.io/posts/jvm/" /><meta property="og:url" content="https://oopty.github.io/posts/jvm/" /><meta property="og:site_name" content="oopty" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-19T21:09:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JVM의 구조와 GC" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-03-11T23:52:50+09:00","datePublished":"2021-12-19T21:09:00+09:00","description":"JVM 구조 JVM은 자바 바이트 코드를 실행할 수 있는 주체이고 일반적으로 인터프리터나 미리 기계어로 만들어 놓는 방식인 JIT(Just in Time) 방식으로 다른 컴퓨터 위에서 바이트 코드를 실행할 수 있도록 만들어 놓은 프로그램 또는 하드웨어이다. 운영체제에 상관없이 JVM위에서 같은 동작이 구동되게 보장하고 GC와 같은 메모리 관리와 클래스 로더를 통해 명령을 실행한다.","headline":"JVM의 구조와 GC","mainEntityOfPage":{"@type":"WebPage","@id":"https://oopty.github.io/posts/jvm/"},"url":"https://oopty.github.io/posts/jvm/"}</script><title>JVM의 구조와 GC | oopty</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="oopty"><meta name="application-name" content="oopty"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /commons/avatar.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">oopty</a></div><div class="site-subtitle font-italic">Stand on the shoulders of giants</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/oopty" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['minjun13795','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>JVM의 구조와 GC</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>JVM의 구조와 GC</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/oopty">oopty</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1639915740" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2021-12-19 </em> </span> <span> Updated <em class="timeago" data-ts="1647010370" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-03-11 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2507 words"> <em>13 min</em> read</span></div></div></div><div class="post-content"><h2 id="jvm-구조"><span class="mr-2">JVM 구조</span><a href="#jvm-구조" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>JVM은 자바 바이트 코드를 실행할 수 있는 주체이고 일반적으로 인터프리터나 미리 기계어로 만들어 놓는 방식인 JIT(Just in Time) 방식으로 다른 컴퓨터 위에서 바이트 코드를 실행할 수 있도록 만들어 놓은 프로그램 또는 하드웨어이다. 운영체제에 상관없이 JVM위에서 같은 동작이 구동되게 보장하고 GC와 같은 메모리 관리와 클래스 로더를 통해 명령을 실행한다.</p><p><img data-src="/assets/images/jvm-flow.png" alt="jvm 실행 흐름" data-proofer-ignore></p><p>위 그림은 자바를 컴파일하고 JVM이 실행하는 흐름을 도식적으로 표현한 것이다. 사용자 코드를 jdk에 포함되어 있는 javac가 자바 소스를 컴파일해 자바 바이트코드를 만들고 클래스 로더가 읽어들여 JVM의 실행이 시작된다. 외부에서 JVM의 코드를 이용할 때는 <a href="https://en.wikipedia.org/wiki/Java_Native_Interface">Java Native Interface</a>를 통해 상효작용한다. 프로그램 실행을 위해 필요한 구성요소인 Runtime Data Areas 중 PC Register, JVM stack, Native Method Stack은 쓰레드마다 생성되고 Heap과 Method Area는 공유한다. Runtime Data Areas의 각 요소를 하나씩 알아보자</p><h3 id="method-area"><span class="mr-2">Method Area</span><a href="#method-area" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>JVM이 시작될 때 생성되며 클래스와 인터페이스의 런타임 상수 풀, 필드와 메서드 코드, static 변수 등을 보관한다.</p><h3 id="heap"><span class="mr-2">Heap</span><a href="#heap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>객체를 생성하면 메모리 할당이 이루어지는 곳이다. 메서드 영역에 로드된 클래스만 생성이 가능하고 GC에 의해 참조되지 않는 객체를 확인 후 제거하는 작업이 이루어진다.</p><h3 id="pc-register"><span class="mr-2">PC Register</span><a href="#pc-register" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>쓰레드가 어떤 부분을 무슨 명령어로 실행해야할 지에 대한 정보를 가지고 있고 현재 수행중인 쓰레드 명령의 주소를 가지고 있다.</p><h3 id="jvm-stack"><span class="mr-2">JVM Stack</span><a href="#jvm-stack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>메서드를 호출하면 리턴 주소, 지역 변수, 매개 변수, 메소드 정보, 연산 중 필요한 임시 데이터를 저장하는 곳이다.</p><h3 id="native-method-stack"><span class="mr-2">Native Method Stack</span><a href="#native-method-stack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Native Method가 호출되면 쌓이는 곳이다. 일반적인 자바 Method가 호출되면 <code class="language-plaintext highlighter-rouge">JVM Stack</code>에 쌓이지만 네이티브 방식의 메서드(C/C++ 형태)가 불려진다면 여기 <code class="language-plaintext highlighter-rouge">Native Method Stack</code>에 쌓인다.</p><h2 id="garbage-collector"><span class="mr-2">Garbage Collector</span><a href="#garbage-collector" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>메모리 관리 기법 중 하나로, 필요없게 된 메모리 영역을 해제하는 기능이다. 단계적으로 <code class="language-plaintext highlighter-rouge">Mark</code>, <code class="language-plaintext highlighter-rouge">Sweep</code> 그리고 <code class="language-plaintext highlighter-rouge">Compact</code>로 나뉘어진다.</p><h3 id="mark--sweep--compact"><span class="mr-2">Mark &amp; Sweep &amp; Compact</span><a href="#mark--sweep--compact" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><code class="language-plaintext highlighter-rouge">Mark</code>: 필요한 객체인지 필요하지 않은 객체인지 대략적으로 구별하고 표시는 단계, 이 객체가 미래에 필요한지는 알 수 없으므로 Reference로 닿을 수 없는 객체를 필요하지 않은 객체로 정의한다.<li><code class="language-plaintext highlighter-rouge">Sweep</code>: <code class="language-plaintext highlighter-rouge">Mark</code>된 객체를 해제하고 반환하는 과정<li><code class="language-plaintext highlighter-rouge">Compact</code>: 제거된 객체때문에 생긴 빈공간을 정리하여 없애는 과정</ul><h3 id="mark-by-reference"><span class="mr-2">Mark by Reference</span><a href="#mark-by-reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>닿을 수 없는 객체를 찾을 때 <code class="language-plaintext highlighter-rouge">JVM Stack</code>과 <code class="language-plaintext highlighter-rouge">Native Method Stack</code> 그리고 <code class="language-plaintext highlighter-rouge">Method Area</code>에 있는 참조를 root로 해서 닿을 수 없는 객체를 찾는다. 닿을 수 있는 객체를 <code class="language-plaintext highlighter-rouge">Reachable</code> 객체, 없는 객체를 <code class="language-plaintext highlighter-rouge">UnReachable</code> 객체라고 정의하고 참조하는 객체를 <code class="language-plaintext highlighter-rouge">Reference Object</code>, 이 객체에 의해 참조되는 객체를 <code class="language-plaintext highlighter-rouge">Referent</code>라고 정의한다.</p><p><img data-src="/assets/images/heap_reference.png" alt="Reference" data-proofer-ignore></p><p>사용자 레벨 코드에서 이 Reference를 변경할 수 없어 GC에 사용자 코드가 관여할 수 없었다. 하지만 <code class="language-plaintext highlighter-rouge">Java 1.2</code>부터 <code class="language-plaintext highlighter-rouge">java.lang.ref</code>패키지를 추가해 soft, weark, phantom 3가지 방식의 레퍼런스를 사용할 수 있게 되었다.</p><h4 id="strong-reference"><span class="mr-2">Strong Reference</span><a href="#strong-reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>new 연산자로 참조값을 생성하거나 참조값을 변수에 대입하면 <code class="language-plaintext highlighter-rouge">Strong Reference</code>로 참조된다. 참조를 타고가다가 닿을 수 있으면 <code class="language-plaintext highlighter-rouge">Strongly Reachable</code> 객체로 구분한다.<li>root set으로 부터 시작해서 어떤 <code class="language-plaintext highlighter-rouge">reference object</code>도 중간에 끼지 않은 상태로 참조 가능한 객체로 정의한다.</ul><h4 id="soft-reference"><span class="mr-2">Soft Reference</span><a href="#soft-reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>root set으로 부터 시작해서 <code class="language-plaintext highlighter-rouge">Strongly Reachable</code>객체가 아닌 객체 중에서 <code class="language-plaintext highlighter-rouge">Weak Reference</code>, <code class="language-plaintext highlighter-rouge">Phantom Reference</code>없이 <code class="language-plaintext highlighter-rouge">Soft Reference</code>가 있는 참조 사슬이 하나라도 있는 객체를 <code class="language-plaintext highlighter-rouge">Sofly Reachable</code> 객체로 정의한다.<li><code class="language-plaintext highlighter-rouge">Softly Reachable</code>객체는 아래 식에 의해 GC를 수행로 때 제거 여부를 결정한다.<blockquote><p>(마지막 strong reference가 GC된 때로부터 지금까지의 시간) &gt; (옵션 설정값 N) * (힙에 남아있는 메모리 크기)</p></blockquote><li>옵션 N은 아래처럼 JVM을 실행할 때 줄수있다. 옵션 설정이 낮을 수록 메모리 회수 속도가 빨라진다.<blockquote><p>-XX:SoftRefLRUPolicyMSPerMB=&lt;N&gt;</p></blockquote></ul><h4 id="weak-reference"><span class="mr-2">Weak Reference</span><a href="#weak-reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>root set으로 부터 시작해서 <code class="language-plaintext highlighter-rouge">Strongly Reachable</code>, <code class="language-plaintext highlighter-rouge">Softly Reachable</code> 객체가 아니고 <code class="language-plaintext highlighter-rouge">Phantom Reference</code>없이 <code class="language-plaintext highlighter-rouge">Weak Reference</code>가 있는 참조 사슬이 하나라도 있는 객체를 <code class="language-plaintext highlighter-rouge">Weakly Reachable</code>객체로 정의한다.<li><code class="language-plaintext highlighter-rouge">Weakly Reachable</code>객체는 매 GC마다 제거된다.<li>매 GC때마다 삭제되도 되는 캐시같은 경우 사용한다.</ul><h4 id="phantom-reference"><span class="mr-2">Phantom Reference</span><a href="#phantom-reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>Finalize 이후의 작업을 처리할 때 사용한다. 참조값을 null로 만드는 clear()를 명시적으로 불러줘야한다.<li>Finalize 작업은 GC에 따라 실행이 안될 수 있고 예외가 발생되면 무시되서 ReferenceQueue에서 지워진 Reference에 대한 후처리 작업을 해준다.</ul><p>GC의 처리 순서는 아래와 같다</p><ol><li>Soft References<li>Weak References<li>Finalize<li>Phantom References<li>메모리 회수</ol><p>Phantom References에 대한 처리는 Finalize 이후에 처리된다. Soft, Weak References는 객체 내의 참조를 null로 바꾼 뒤 ReferenceQueue에 enqueue되지만 Phantom References는 발견되자마자 Finalize 이후 ReferenceQueue에 넣어진다. 사용자 코드에서 이 ReferenceQueue에 접근해 후처리 작업을 할 수 있으며 <code class="language-plaintext highlighter-rouge">clear()</code> 메서드를 통해 참조를 null로 만들어 주어야한다.</p><h3 id="gc-알고리즘"><span class="mr-2">GC 알고리즘</span><a href="#gc-알고리즘" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>GC는 Heap에서 메모리 관리를 위해 일어나며 <code class="language-plaintext highlighter-rouge">Mark</code> -&gt; <code class="language-plaintext highlighter-rouge">Sweep</code> -&gt; <code class="language-plaintext highlighter-rouge">Compact</code>순으로 일어난다.</p><h4 id="heap-메모리-구조"><span class="mr-2">Heap 메모리 구조</span><a href="#heap-메모리-구조" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p><img data-src="/assets/images/JVM_heap_structure.png" alt="Heap 메모리 구조" data-proofer-ignore></p><p>힙영역은 <code class="language-plaintext highlighter-rouge">Young</code> 영역과 <code class="language-plaintext highlighter-rouge">Old</code> 영역과 <code class="language-plaintext highlighter-rouge">Perm</code> 영역으로 나뉘어진다. 그리고 <code class="language-plaintext highlighter-rouge">Young</code> 영역은 <code class="language-plaintext highlighter-rouge">Eden</code>과 두 개의 <code class="language-plaintext highlighter-rouge">Survivor</code>영역으로 나뉘어진다. 새로 생성되는 객체는 대부분 <code class="language-plaintext highlighter-rouge">Eden</code>영역에 할당된다. 할당될 때 bump-the-pointer와 TLABs(Thread-Local Allocation Buffers)라는 기술이 쓰이는데 bump-then-pointer는 마지막으로 할당된 객체의 참조를 가지고 있어서 새로운 메모리 할당이 일어날때 신속하게 사이즈 체크와 할당이 이루어진다. TLABs는 여러 쓰레드가 동시에 할당하려고 할 때 안정성에 문제가 있으므로 각 쓰레드마다 Eden영역을 나눠가질 수 있게 만든 것이다.</p><h4 id="young-영역의-구성과-gc"><span class="mr-2">Young 영역의 구성과 GC</span><a href="#young-영역의-구성과-gc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p><img data-src="/assets/images/YoungGenGC.png" alt="Young Gen GC" data-proofer-ignore></p><p><code class="language-plaintext highlighter-rouge">Young</code>영역은 <code class="language-plaintext highlighter-rouge">Eden</code>과 두 개의 <code class="language-plaintext highlighter-rouge">Survivor</code>영역으로 구성되고 <code class="language-plaintext highlighter-rouge">Minor GC</code>로 메모리 관리를 한다. <code class="language-plaintext highlighter-rouge">Eden</code> 영역에서 GC가 발생한 후 살아남은 객체들은 두 <code class="language-plaintext highlighter-rouge">Survivor</code> 영역 중 한 곳으로 이동한다. 이 <code class="language-plaintext highlighter-rouge">Survivor</code>영역이 가득차게 되면 GC가 동작하고 살아남은 객체들은 다른 <code class="language-plaintext highlighter-rouge">Survivor</code>영역으로 이동한다. 몇 번의 반복 후에도 살아남은 객체는 Old 영역으로 이동한다. Old영역으로 넘어가는 기준은 MaxTenuringThreshold 설정값을 통해 조절 가능하다. Minor GC에서도 STW(Stop-The-World)는 일어나고 살아남는 객체가 많을 수록 이동하는 시간이 길어져 STW 시간이 길어진다.</p><h4 id="gc-알고리즘-1"><span class="mr-2">GC 알고리즘</span><a href="#gc-알고리즘-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>GC 알고리즘은 JVM 옵션으로 선택할 수 있으며 각 어플리케이션에 맞게 끔 여러 요인을 따져보고 선택해야한다.</p><h5 id="serial-gc--xxuserserialgc"><span class="mr-2">Serial GC (-XX:+UserSerialGC)</span><a href="#serial-gc--xxuserserialgc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><p>Serial GC는 32bit JVM의 기본값이며 타겟 플랫폼의 CPU 코어 수가 적은 경우 유리하다. 하나의 쓰레드가 <code class="language-plaintext highlighter-rouge">Mark</code>, <code class="language-plaintext highlighter-rouge">Sweep</code>, <code class="language-plaintext highlighter-rouge">Compact</code>하는 방법이다.</p><h5 id="parallel-gc--xxuseparallelgc"><span class="mr-2">Parallel GC (-XX:+UseParallelGC)</span><a href="#parallel-gc--xxuseparallelgc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><p><img data-src="/assets/images/SerialGCvsParallelGC.png" alt="Parallel GC vs Serial GC" data-proofer-ignore></p><p>Serial GC를 병렬로 처리해 STW 시간을 줄인 방법이다.</p><h5 id="parallel-old-gc-xxuseparalleloldgc"><span class="mr-2">Parallel Old GC(-XX:+UseParallelOldGC)</span><a href="#parallel-old-gc-xxuseparalleloldgc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><p>위 과정과 비슷하지만 Old 영역의 GC가 <code class="language-plaintext highlighter-rouge">Mark</code> -&gt; <code class="language-plaintext highlighter-rouge">Summary</code> -&gt; <code class="language-plaintext highlighter-rouge">Compact</code> 과정을 거친다. <code class="language-plaintext highlighter-rouge">Summary</code> 단계는 <code class="language-plaintext highlighter-rouge">Sweep</code> 단계와 다르게 여러 쓰레드가 동시에 훑는다고 한다. 그리고 앞선 GC에서 Compact된 영역도 별도로 훑는다.</p><h5 id="cms-gc--xxuseconcmarkseepgc"><span class="mr-2">CMS GC (-XX:+UseConcMarkSeepGC)</span><a href="#cms-gc--xxuseconcmarkseepgc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><p><img data-src="/assets/images/CMSGC.png" alt="CMS GC" data-proofer-ignore></p><p>각 단계를 나눠 중간에 다른 작업을 할 수 있게 끔 만든 것이다. STW 시간을 줄였으며 초기 root set을 찾는 과정인 <code class="language-plaintext highlighter-rouge">Initial Mark</code>와 Concurrent Mark 도중 생기는 객체를 위해 수행하는 <code class="language-plaintext highlighter-rouge">Remark</code> 이 두 단계에서만 STW가 일어난다.</p><h5 id="g1-gc"><span class="mr-2">G1 GC</span><a href="#g1-gc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5></h5><p><img data-src="/assets/images/G1GC.png" alt="G1 GC" data-proofer-ignore></p><p>G1 GC는 Young 영역과 Old 영역이 나뉘어져 적용되던 위 4가지 방법과 다르게 메모리를 구역별로 나눠 해당 영역이 가득 차면 다른 영역에 객체를 할당하고 GC를 수행하는 방식이다. 위 4가지 방법과 비교했을 때 가장 빠르다.</p><h2 id="다음은-gc-모니터링과-튜닝-방법"><span class="mr-2">다음은 GC 모니터링과 튜닝 방법</span><a href="#다음은-gc-모니터링과-튜닝-방법" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>인터넷에 돌아다니는 정보들을 찾아보고 정리해보았는데요. 궁금한 것에 대해 찾아보려해도 자세한 내용을 설명하는 글은 많지 않네요. 관리 툴을 사용해보면서 직접 메모리를 보며 실전 경험으로 알아가야 할 거 같습니다. 😅 다음 포스팅은 GC 모니터링과 튜닝 방법에 대해 공부하고 정리할게요!</p><h2 id="참고-자료"><span class="mr-2">참고 자료</span><a href="#참고-자료" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="https://d2.naver.com/helloworld/1329">네이버 D2: Java Garbage Collection</a><li><a href="https://d2.naver.com/helloworld/329631">네이버 D2: Java Reference와 GC</a><li><a href="https://luckydavekim.github.io/development/back-end/java/phantom-reference-in-java">Java Phantom Reachable, Phantom Reference 란</a><li><a href="https://plumbr.io/handbook/garbage-collection-in-java/minor-gc-major-gc-full-gc">JAVA GARBAGE COLLECTION HANDBOOK</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/gc/" class="post-tag no-text-decoration" >gc</a> <a href="/tags/garbege-collector/" class="post-tag no-text-decoration" >garbege collector</a> <a href="/tags/jvm/" class="post-tag no-text-decoration" >jvm</a> <a href="/tags/soft-refrence/" class="post-tag no-text-decoration" >soft refrence</a> <a href="/tags/stong-reference/" class="post-tag no-text-decoration" >stong reference</a> <a href="/tags/weak-reference/" class="post-tag no-text-decoration" >weak reference</a> <a href="/tags/phantom-reference/" class="post-tag no-text-decoration" >phantom reference</a> <a href="/tags/young-area/" class="post-tag no-text-decoration" >young area</a> <a href="/tags/old-area/" class="post-tag no-text-decoration" >old area</a> <a href="/tags/perm-area/" class="post-tag no-text-decoration" >perm area</a> <a href="/tags/serial-gc/" class="post-tag no-text-decoration" >serial gc</a> <a href="/tags/parallel-gc/" class="post-tag no-text-decoration" >parallel gc</a> <a href="/tags/parallel-old-gc/" class="post-tag no-text-decoration" >parallel old gc</a> <a href="/tags/cms-gc/" class="post-tag no-text-decoration" >cms gc</a> <a href="/tags/g1-gc/" class="post-tag no-text-decoration" >g1 gc</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JVM%EC%9D%98+%EA%B5%AC%EC%A1%B0%EC%99%80+GC+-+oopty&url=https%3A%2F%2Foopty.github.io%2Fposts%2Fjvm%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JVM%EC%9D%98+%EA%B5%AC%EC%A1%B0%EC%99%80+GC+-+oopty&u=https%3A%2F%2Foopty.github.io%2Fposts%2Fjvm%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Foopty.github.io%2Fposts%2Fjvm%2F&text=JVM%EC%9D%98+%EA%B5%AC%EC%A1%B0%EC%99%80+GC+-+oopty" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/effective-java-item-1/">Effective Java 정리 Item1</a><li><a href="/posts/gc-tuning/">가비지 컬렉터 튜닝</a><li><a href="/posts/java-study1/">함수형 프로그래밍의 의미와 장점</a><li><a href="/posts/javascript-execution-concepts/">자바스크립트 동작 원리에대한 개념 정리</a><li><a href="/posts/linux-concept-is-confused/">리눅스 헷갈리는 개념 포스팅</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/gc/">gc</a> <a class="post-tag" href="/tags/garbege-collector/">garbege collector</a> <a class="post-tag" href="/tags/jvm/">jvm</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/anotation/">anotation</a> <a class="post-tag" href="/tags/chmod/">chmod</a> <a class="post-tag" href="/tags/cms-gc/">cms gc</a> <a class="post-tag" href="/tags/collaberations/">collaberations</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/gc-tuning/"><div class="card-body"> <em class="timeago small" data-ts="1654967640" > 2022-06-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>가비지 컬렉터 튜닝</h3><div class="text-muted small"><p> 지난 이야기 Garbage Collector에 대해 정리해놓은 글에서 Reference &amp;amp; Reachable Object와 Heap 영역의 구조, GC 알고리즘에 대해 설명했습니다. 이번 시간에는 Parallel Collector에 대해 조금 더 설명한 후에 GC 튜닝 방법에 대해 설명하려고 합니다. Parallel Collector (Thro...</p></div></div></a></div><div class="card"> <a href="/posts/javascript-execution-concepts/"><div class="card-body"> <em class="timeago small" data-ts="1639320300" > 2021-12-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자바스크립트 동작 원리에대한 개념 정리</h3><div class="text-muted small"><p> 시작하며 이번에는 자바 런타임에서 바이트코드를 실행할 수 있는 JVM(Java Virtual Machine)과 Javascript 엔진인 V8에 대해 비교하며 살펴보려고 합니다. 개발하다 보면 많이 듣는 용어고 의미정도는 어렴풋이 알고 있긴 하지만 설명을 하라고 하면 못할 거 같습니다.. 😓 그래서 이번엔 V8과 JVM에 대해 정리하고 관련된 용어(N...</p></div></div></a></div><div class="card"> <a href="/posts/mvc-testing/"><div class="card-body"> <em class="timeago small" data-ts="1656760440" > 2022-07-02 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring Boot와 @WebMVCTest로 MVC Controller를 테스트 하는 방법</h3><div class="text-muted small"><p> 이 글은 Testing MVC Web Controllers with Spring Boot and @WebMvcTest을 해석하고 정리한 글입니다. 이번 글에서는 Controller에 대해 살펴볼 것이다. 먼저 책임 전체를 수용하는 테스트를 작성하기 위해 web Controller가 무엇을 하는지 탐색할 것이다. 그러고 각각 책임을 수용하는 테스트를 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/javascript-execution-concepts/" class="btn btn-outline-primary" prompt="Older"><p>자바스크립트 동작 원리에대한 개념 정리</p></a> <a href="/posts/complete-guide-to-exception-handling-in-spring-boot/" class="btn btn-outline-primary" prompt="Newer"><p>스프링 부트 예외처리 완벽 가이드</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/oopty">oopty</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/gc/">gc</a> <a class="post-tag" href="/tags/garbege-collector/">garbege collector</a> <a class="post-tag" href="/tags/jvm/">jvm</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/anotation/">anotation</a> <a class="post-tag" href="/tags/chmod/">chmod</a> <a class="post-tag" href="/tags/cms-gc/">cms gc</a> <a class="post-tag" href="/tags/collaberations/">collaberations</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-D6L4PXVM2Z"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-D6L4PXVM2Z'); }); </script>
