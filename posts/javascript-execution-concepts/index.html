<!DOCTYPE html><html lang="custom" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="prefer-datetime-locale" content="ko"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="자바스크립트 동작 원리에대한 개념 정리" /><meta property="og:locale" content="custom" /><meta name="description" content="시작하며 이번에는 자바 런타임에서 바이트코드를 실행할 수 있는 JVM(Java Virtual Machine)과 Javascript 엔진인 V8에 대해 비교하며 살펴보려고 합니다. 개발하다 보면 많이 듣는 용어고 의미정도는 어렴풋이 알고 있긴 하지만 설명을 하라고 하면 못할 거 같습니다.. 😓 그래서 이번엔 V8과 JVM에 대해 정리하고 관련된 용어(Node.js, ECMAScript, JDK, GC)도 공부해보려고 합니다. 잘못된 정보나 제 말에 억측이 있어 짚어주신다면 고맙겠습니다~ 😊" /><meta property="og:description" content="시작하며 이번에는 자바 런타임에서 바이트코드를 실행할 수 있는 JVM(Java Virtual Machine)과 Javascript 엔진인 V8에 대해 비교하며 살펴보려고 합니다. 개발하다 보면 많이 듣는 용어고 의미정도는 어렴풋이 알고 있긴 하지만 설명을 하라고 하면 못할 거 같습니다.. 😓 그래서 이번엔 V8과 JVM에 대해 정리하고 관련된 용어(Node.js, ECMAScript, JDK, GC)도 공부해보려고 합니다. 잘못된 정보나 제 말에 억측이 있어 짚어주신다면 고맙겠습니다~ 😊" /><link rel="canonical" href="https://oopty.github.io/posts/javascript-execution-concepts/" /><meta property="og:url" content="https://oopty.github.io/posts/javascript-execution-concepts/" /><meta property="og:site_name" content="oopty" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-12T23:45:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="자바스크립트 동작 원리에대한 개념 정리" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-03T22:20:16+09:00","datePublished":"2021-12-12T23:45:00+09:00","description":"시작하며 이번에는 자바 런타임에서 바이트코드를 실행할 수 있는 JVM(Java Virtual Machine)과 Javascript 엔진인 V8에 대해 비교하며 살펴보려고 합니다. 개발하다 보면 많이 듣는 용어고 의미정도는 어렴풋이 알고 있긴 하지만 설명을 하라고 하면 못할 거 같습니다.. 😓 그래서 이번엔 V8과 JVM에 대해 정리하고 관련된 용어(Node.js, ECMAScript, JDK, GC)도 공부해보려고 합니다. 잘못된 정보나 제 말에 억측이 있어 짚어주신다면 고맙겠습니다~ 😊","headline":"자바스크립트 동작 원리에대한 개념 정리","mainEntityOfPage":{"@type":"WebPage","@id":"https://oopty.github.io/posts/javascript-execution-concepts/"},"url":"https://oopty.github.io/posts/javascript-execution-concepts/"}</script><title>자바스크립트 동작 원리에대한 개념 정리 | oopty</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="oopty"><meta name="application-name" content="oopty"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /commons/avatar.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">oopty</a></div><div class="site-subtitle font-italic">Stand on the shoulders of giants</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/oopty" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['minjun13795','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>자바스크립트 동작 원리에대한 개념 정리</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>자바스크립트 동작 원리에대한 개념 정리</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/oopty">oopty</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1639320300" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2021-12-12 </em> </span> <span> Updated <em class="timeago" data-ts="1656854416" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-07-03 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2701 words"> <em>15 min</em> read</span></div></div></div><div class="post-content"><h2 id="시작하며"><span class="mr-2">시작하며</span><a href="#시작하며" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>이번에는 자바 런타임에서 바이트코드를 실행할 수 있는 JVM(Java Virtual Machine)과 Javascript 엔진인 V8에 대해 비교하며 살펴보려고 합니다. 개발하다 보면 많이 듣는 용어고 의미정도는 어렴풋이 알고 있긴 하지만 설명을 하라고 하면 못할 거 같습니다.. 😓 그래서 이번엔 V8과 JVM에 대해 정리하고 관련된 용어(<code class="language-plaintext highlighter-rouge">Node.js</code>, <code class="language-plaintext highlighter-rouge">ECMAScript</code>, <code class="language-plaintext highlighter-rouge">JDK</code>, <code class="language-plaintext highlighter-rouge">GC</code>)도 공부해보려고 합니다. 잘못된 정보나 제 말에 억측이 있어 짚어주신다면 고맙겠습니다~ 😊</p><h2 id="v8-엔진에-대해서"><span class="mr-2">V8 엔진에 대해서</span><a href="#v8-엔진에-대해서" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>V8 개발자 사이트(<a href="https://v8.dev/">v8.dev</a>)에 접속하면 아래와 같이 V8을 말하고 있다.</p><blockquote><p>V8 is Google’s open source high-performance JavaScript and WebAssembly engine, written in C++. It is used in Chrome and in Node.js, among others. It implements ECMAScript and WebAssembly, and runs on Windows 7 or later, macOS 10.12+, and Linux systems that use x64, IA-32, ARM, or MIPS processors. V8 can run standalone, or can be embedded into any C++ application.</p></blockquote><p>정리하면 <code class="language-plaintext highlighter-rouge">C++</code>로 구현된 <code class="language-plaintext highlighter-rouge">Javascript와</code> <code class="language-plaintext highlighter-rouge">WebAssembly</code> 엔진이고 ECMAScript의 구현체이다. 또한 여러 플랫폼 위에서 standalone 방식으로 실행될 수 잇고 C++ 임베디드 환경에서도 사용 가능하다. Javascript는 익숙한데 WebAssembly는 무엇일까? WebAssembly는 스택기반 가상환경에서 실행할 수 있는 바이너리 코드 포맷이다. 웹의 브라우저나 서버에 배포할 수 있도록 포터블하게 디자인 되어있다. 쉽게 말하면, C나 C++로 프로그래밍한 결과를 브라우저에서 실행시켜주는 기술이다. 장점으로는 빠르고 효과적인 실행이 있다. 네이티브 어플리케이션의 속도를 목표로 한다고 한다. 또한 웹 플랫폼의 일부분으로서 <code class="language-plaintext highlighter-rouge">Javascript</code>에서 실행될 수 있고 역으로 <code class="language-plaintext highlighter-rouge">Javascript</code>를 실행할 수 도 있다. 더 알고 싶다면 <a href="https://webassembly.org/">webassembly</a>를 참고하자. 어쨋든 V8엔진은 <code class="language-plaintext highlighter-rouge">Javascript</code>뿐만 아니라 <code class="language-plaintext highlighter-rouge">WebAssembly</code>도 포함한 엔진이다.</p><p>ECMAScript는 Ecma International(국제 정보 통신 시스템 국제화 기구)이 ECMA-262 기술 규격에 따라 정의하고 있는 표준화된 스크립트 프로그래밍 언어이다. 자바스크립트를 표준화하기 위해 만들어 졌고 액션스크립나 J스크립트 등 다른 구현체도 있다. <code class="language-plaintext highlighter-rouge">Node.js</code>같이 서버 응용 프로그램에도 쓰이고 있다. 쉽게 말하면 자바스크립트를 표준화시킨 규격이다.</p><h2 id="v8-엔진-구조"><span class="mr-2">V8 엔진 구조</span><a href="#v8-엔진-구조" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>프런트엔드 코드를 작성하면서 알 필요는 없지만 항상 궁금했다. C나 C++은 학교 교수님이 어떻게 어셈블리어로 바뀌고 실행이 되는지 자세하진 않지만 설명을 들었고 그 만큼 코드가 어떻게 동작할지 예상이 되었다. V8 엔진에 대해서도 대략적으로나마 알아보자</p><p><img data-src="/assets/images/v8-engine.png" alt="v8엔진" data-proofer-ignore></p><p>V8은 내연 기관에 들어가는 8기통 엔진에서 유래되었다고 한다. 각 크랭크실에 가스를 분사한 후 점화를 일으켜 피스톤이 운동에너지를 전달한다. 과열된 엔진은 그릴에서 들어오는 바람이나 팬으로 냉각한다. 자바스크립트 엔진인 V8에서도 비슷한 내부 로직이 보인다. V8의 parser는 자바스크립트 소스를 읽어 들여 AST(추상 문법 트리)로 만든다. 그리고 Interpreter Ignition으로 byteCode를 만들어 실행할 수 있게 점화한다. 어떤 코드가 유난히 많이 실행이 되면 TurboFan이 코드 최적화를 시켜 엔진의 속도를 높인다. 더 자세히 알면 좋지만 byteCode나 TurBoFan이 어떻게 최적화 하는지는 나중에 찾아보기로 한다.</p><h2 id="가비지-컬렉터gc"><span class="mr-2">가비지 컬렉터(GC)</span><a href="#가비지-컬렉터gc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>C와 같은 저수준 언어에서는 프로그래머가 명시적으로 메모리의 할당과 해제를 수행하지만 자바스크립트 같은 고수준 언어는 객체가 생성되었을 때 자동으로 메모리를 할당하고 필요없을 때 해제한다. 하지만 이런 메모리 관리가 개발자에게 메모리 관리에 대한 고민을 완전히 없애고 신경쓰지 않아도 된다는 것은 아니다. 메모리의 생명주기는 언어에 관계없이 대부분 아래와 같다.</p><ol><li>메모리 생성<li>사용한다.<li>필요없어지면 해제한다.</ol><p>3번에서 대부분의 문제가 발생한다. 언제 필요없어지는지 알수가 없기 때문이다. 어떤 메모리가 여전히 필요한지 아닌지를 판단하는 것은 <a href="https://en.wikipedia.org/wiki/Decidability_%28logic%29">비결정적 문제</a>이기 때문이다. 따라서 가비지 컬렉터(GC)는 제한적인 해결책을 제시한다.</p><ul><li>참조-세기(Reference-counting) 가비지 컬렉션 단순한 알고리즘이다. <code class="language-plaintext highlighter-rouge">더 이상 필요없는 오브젝트</code>를 <code class="language-plaintext highlighter-rouge">어떤 다른 오브젝트도 참조하지 않는 오브젝트</code>라고 정의한다. 다시말하면 자신 또는 자신의 속성을 참조하는 변수가 없는 오브젝트는 삭제하는 것이다. 하지만 아래와 같은 순환 참조에서는 스코프를 벗어나 객체가 메모리에서 회수되어야 하지만 회수되지 않는다. 참조-세기 가비지 컬렉터에서 메모리 누수의 흔한 원인이다.</ul><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">x</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
    <span class="nx">y</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>

    <span class="k">return</span> <span class="dl">"</span><span class="s2">oopty!</span><span class="dl">"</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">f</span><span class="p">();</span>
</pre></table></code></div></div><p>자기 자신의 속성이 자신을 참조하는 경우도 순환참조라고 볼 수 있다.</p><ul><li>표시하고-쓸기(Mark-and_sweep) 알고리즘</ul><p>이 알고리즘은 <code class="language-plaintext highlighter-rouge">더 이상 필요없는 오브젝트</code>를 <code class="language-plaintext highlighter-rouge">닿을 수 없는 오브젝트</code>로 정의한다. <code class="language-plaintext highlighter-rouge">roots</code>라는 오브젝트 집합을 가지고 있고 주기적으로 가비지 컬렉터는 <code class="language-plaintext highlighter-rouge">roots</code>에서 시작하여 참조할 수 있는 오브젝트를 닿을 수 있는 오브젝트라고 표시한다. 그리고 닿을 수 없는 오브젝트들에 대해 가비지 컬렉터를 수행한다.</p><p>이는 참조-세기 알고리즘보다 효율적이다. 즉 더 많은 오브젝트의 메모리를 해제한다. 왜냐하면 <code class="language-plaintext highlighter-rouge">참조하지 않는 오브젝트</code>는 모두 <code class="language-plaintext highlighter-rouge">닿을 수 잇는 오브젝트</code>이지만 역은 성립하지 않기 때문이다. 반례로 순환 참조하는 오브젝트를 들수있다. 2012년 기준으로 모든 최신 브라우저는 표시하고-쓸기(Mark-and-sweep) 알고리즘을 사용한다고 한다.</p><ul><li>수동 메모리 해제</ul><p>2019년 기준으로 자바스크립트는 메모리 해제를 명시적으로 할 수 없다.</p><ul><li>힙 메모리 사용량 늘리기</ul><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>node <span class="nt">--max-old-space-size</span><span class="o">=</span>6000 index.js
</pre></table></code></div></div><ul><li>가비지 수집기 디버깅</ul><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>node <span class="nt">--expose-gc</span> <span class="nt">--inspect</span> index.js
</pre></table></code></div></div><h2 id="이벤트-루프"><span class="mr-2">이벤트 루프</span><a href="#이벤트-루프" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>자바스크립트는 ‘단일 스레드’기반의 언어다. 하지만 브라우저를 사용해 보면 렌더링을 하는 동시에 HTTP request도 보내고 setTimeout으로 콜백을 전달하기도 한다. 이러한 동작은 단일 스레드에서 어떻게 수행하는 것일까? 즉, 자바스크립트의 동시성(Concurrency)는 어떻게 동작하는 것일까?</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100% 100%'%3E%3C/svg%3E" data-src="/assets/images/highLevelEventLoopView.jpg" alt="이벤트 루프 고수준 관점" width="100%" height="100%" data-proofer-ignore></p><p>이벤트 루프는 V8엔진에 있는 것이 아니라 비동기 I/O를 지원하는 멀티 플랫폼 C라이브러리인 LibUV에 있다. 자바스크립트의 규격인 ECMAScript에는 이벤트 루프나 비동기에 관련된 언급이 없다고 한다. libUV가 있기 때문에 자바스크립트에서 동시성을 사용할 수 있는 것이다.</p><p><img data-src="/assets/images/lowLevelEventLoopView.png" alt="이벤트 루프 저수준 관점" data-proofer-ignore></p><p>총 7개의 페이즈가 있고 각 페이즈마다 특정 역할이 있다. 각 페이즈는 큐를 가지고 있고 자바스크립트는 idle과 prepare을 제외하고 실행될 수 있다.</p><h3 id="timer-phase"><span class="mr-2">Timer Phase</span><a href="#timer-phase" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>이벤트 루프의 시작이고 타이머들의 콜백을 min heap에 가지고 있다가 시간이 지나면 해당 타이머를 큐에 넣고 실행한다.</p><h3 id="pending-io-callback-phase"><span class="mr-2">Pending i/o callback phase</span><a href="#pending-io-callback-phase" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">pending_queue</code>에 들어가 있는 콜백을 실행한다. <code class="language-plaintext highlighter-rouge">poll phase</code>에서 pending된 i/o 콜백을 실행하는 거 같다.</p><h3 id="idle-prepare-pahse"><span class="mr-2">Idle, Prepare pahse</span><a href="#idle-prepare-pahse" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>이름은 Idle Phase이지만 이 페이즈는 매 tick마다 실행한다. Node.js의 내부관리를 위해 사용하는 것이다.</p><h3 id="poll-phase"><span class="mr-2">Poll phase</span><a href="#poll-phase" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>새로운 수신 커넥션과 데이터 읽기/쓰기 등 대부분의 콜백을 실행한다. <code class="language-plaintext highlighter-rouge">watch_queue</code>가 비어있지 않다면, 큐가 비거나 시스템 최대 실행 한도에 다다를때까지 동기적으로 콜백을 실행, 비어있다면 <code class="language-plaintext highlighter-rouge">Check phase</code> 로 넘어가거나 약간의 대기시간을 가지게 되고 타이머 min heap에서 하나를 꺼내고 타이머가 실행 가능한 상태면 타이머의 딜레이 시간만큼 대기한다.</p><h3 id="check-phase"><span class="mr-2">Check phase</span><a href="#check-phase" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">setImmediate()</code> API의 콜백을 큐가 비거나 실행 한도가 초과될 때까지 실행한다.</p><h3 id="close-callback"><span class="mr-2">Close Callback</span><a href="#close-callback" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>커넥션을 닫거나 종료하는 콜백을 실행한다.</p><h3 id="nexttickqueue--microtaskqueue"><span class="mr-2">nextTickQueue &amp; microTaskQueue</span><a href="#nexttickqueue--microtaskqueue" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>다음 페이즈로 넘어가기 전에 두 큐에 있는 콜백을 높은 우선순위로 실행한다. <code class="language-plaintext highlighter-rouge">nextTickQueue</code>가 <code class="language-plaintext highlighter-rouge">microTaskQueue</code>보다 높은 우선순위를 가지고 있다.</p><h2 id="마치면서"><span class="mr-2">마치면서</span><a href="#마치면서" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>프로그래밍을 하면서 그냥 지나쳤던 자바스크립트의 동작 원리에 대해 간단히 정리해 보았습니다. 대략적인 개념 정도로 정리했고 자세한 내용은 포스팅 하나하나로 정리해야 할 거 같습니다. 특히 이벤트 루프관련된 내용이 자바스크립트 실행 순서와 관련된 내용이라서 꼭 한번 정리하겠습니다.</p><h2 id="참고자료"><span class="mr-2">참고자료</span><a href="#참고자료" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="https://evan-moon.github.io/2019/08/01/nodejs-event-loop-workflow/">Evans Library: 로우레벨로 살펴보는 Node.js 이벤트 루프</a><li><a href="https://meetup.toast.com/posts/89">NHN Cloud MeetUp: 자바크립트와 이벤트 루프</a><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/EventLoop">MDN Web Docs: 동시성 모델과 이벤트 루프</a><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Memory_Management">MDN Web Docs: 자바스크립트의 메모리관</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/javascript/'>javascript</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/javascript/" class="post-tag no-text-decoration" >javascript</a> <a href="/tags/v8/" class="post-tag no-text-decoration" >v8</a> <a href="/tags/webassembly/" class="post-tag no-text-decoration" >webassembly</a> <a href="/tags/node-js/" class="post-tag no-text-decoration" >node.js</a> <a href="/tags/garbege-collector/" class="post-tag no-text-decoration" >garbege collector</a> <a href="/tags/gc/" class="post-tag no-text-decoration" >gc</a> <a href="/tags/event-loop/" class="post-tag no-text-decoration" >event loop</a> <a href="/tags/single-thread/" class="post-tag no-text-decoration" >single thread</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8+%EB%8F%99%EC%9E%91+%EC%9B%90%EB%A6%AC%EC%97%90%EB%8C%80%ED%95%9C+%EA%B0%9C%EB%85%90+%EC%A0%95%EB%A6%AC+-+oopty&url=https%3A%2F%2Foopty.github.io%2Fposts%2Fjavascript-execution-concepts%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8+%EB%8F%99%EC%9E%91+%EC%9B%90%EB%A6%AC%EC%97%90%EB%8C%80%ED%95%9C+%EA%B0%9C%EB%85%90+%EC%A0%95%EB%A6%AC+-+oopty&u=https%3A%2F%2Foopty.github.io%2Fposts%2Fjavascript-execution-concepts%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Foopty.github.io%2Fposts%2Fjavascript-execution-concepts%2F&text=%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8+%EB%8F%99%EC%9E%91+%EC%9B%90%EB%A6%AC%EC%97%90%EB%8C%80%ED%95%9C+%EA%B0%9C%EB%85%90+%EC%A0%95%EB%A6%AC+-+oopty" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/effective-java-item-1/">Effective Java 정리 Item1</a><li><a href="/posts/gc-tuning/">가비지 컬렉터 튜닝</a><li><a href="/posts/java-study1/">함수형 프로그래밍의 의미와 장점</a><li><a href="/posts/javascript-execution-concepts/">자바스크립트 동작 원리에대한 개념 정리</a><li><a href="/posts/linux-concept-is-confused/">리눅스 헷갈리는 개념 포스팅</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/gc/">gc</a> <a class="post-tag" href="/tags/garbege-collector/">garbege collector</a> <a class="post-tag" href="/tags/jvm/">jvm</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/anotation/">anotation</a> <a class="post-tag" href="/tags/chmod/">chmod</a> <a class="post-tag" href="/tags/cms-gc/">cms gc</a> <a class="post-tag" href="/tags/collaberations/">collaberations</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/jvm/"><div class="card-body"> <em class="timeago small" data-ts="1639915740" > 2021-12-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JVM의 구조와 GC</h3><div class="text-muted small"><p> JVM 구조 JVM은 자바 바이트 코드를 실행할 수 있는 주체이고 일반적으로 인터프리터나 미리 기계어로 만들어 놓는 방식인 JIT(Just in Time) 방식으로 다른 컴퓨터 위에서 바이트 코드를 실행할 수 있도록 만들어 놓은 프로그램 또는 하드웨어이다. 운영체제에 상관없이 JVM위에서 같은 동작이 구동되게 보장하고 GC와 같은 메모리 관리와 클래스...</p></div></div></a></div><div class="card"> <a href="/posts/gc-tuning/"><div class="card-body"> <em class="timeago small" data-ts="1654967640" > 2022-06-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>가비지 컬렉터 튜닝</h3><div class="text-muted small"><p> 지난 이야기 Garbage Collector에 대해 정리해놓은 글에서 Reference &amp;amp; Reachable Object와 Heap 영역의 구조, GC 알고리즘에 대해 설명했습니다. 이번 시간에는 Parallel Collector에 대해 조금 더 설명한 후에 GC 튜닝 방법에 대해 설명하려고 합니다. Parallel Collector (Thro...</p></div></div></a></div><div class="card"> <a href="/posts/effective-java-item-7/"><div class="card-body"> <em class="timeago small" data-ts="1693008000" > 2023-08-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Effective Java 정리 Item10 [Eqauls는 일반 규약을 지켜 재정의하라]</h3><div class="text-muted small"><p> eqauls 메서드는 Object 클래스에 정의되어 있고 기본적으로 동일성(identity) 검사를 하게 됩니다. 즉, 가지고 있는 속성(멤버 변수)가 같아도 객체가 다르면 false를 반환한다는 말입니다. 이 Equals를 재정의 할 때는 고려해야할 것이 많고 구현하고 검증 과정을 반드시 거쳐야 하기 때문에 정말 eqauls를 구현해야 하는 것이 맞...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/java-study1/" class="btn btn-outline-primary" prompt="Older"><p>함수형 프로그래밍의 의미와 장점</p></a> <a href="/posts/jvm/" class="btn btn-outline-primary" prompt="Newer"><p>JVM의 구조와 GC</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/oopty">oopty</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/effectivejava/">effectivejava</a> <a class="post-tag" href="/tags/gc/">gc</a> <a class="post-tag" href="/tags/garbege-collector/">garbege collector</a> <a class="post-tag" href="/tags/jvm/">jvm</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/anotation/">anotation</a> <a class="post-tag" href="/tags/chmod/">chmod</a> <a class="post-tag" href="/tags/cms-gc/">cms gc</a> <a class="post-tag" href="/tags/collaberations/">collaberations</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-D6L4PXVM2Z"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-D6L4PXVM2Z'); }); </script>
